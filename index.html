<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üåà Ellie's Super Fun Daily Adventure Schedule! üåü</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Comic+Neue:wght@300;400;700&family=Fredoka+One&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body {
            font-family: 'Comic Neue', cursive;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        .title-font {
            font-family: 'Fredoka One', cursive;
        }
        .sparkle {
            animation: sparkle 2s infinite;
        }
        @keyframes sparkle {
            0%, 100% { transform: scale(1) rotate(0deg); }
            50% { transform: scale(1.1) rotate(180deg); }
        }
        .bounce {
            animation: bounce 2s infinite;
        }
        @keyframes bounce {
            0%, 20%, 50%, 80%, 100% { transform: translateY(0); }
            40% { transform: translateY(-10px); }
            60% { transform: translateY(-5px); }
        }
        .activity-card {
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        .activity-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 20px 40px rgba(0,0,0,0.2);
        }
        .completed {
            background: linear-gradient(135deg, #84fab0 0%, #8fd3f4 100%);
            transform: scale(0.95);
        }
        .progress-ring {
            transform: rotate(-90deg);
        }
        .celebration {
            animation: celebrate 1s ease-in-out;
        }
        @keyframes celebrate {
            0% { transform: scale(1); }
            50% { transform: scale(1.2); }
            100% { transform: scale(1); }
        }
        .day-info {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
            padding: 1rem;
            border-radius: 1rem;
            margin-bottom: 1rem;
            text-align: center;
        }
        .pin-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 9999;
        }
        .pin-input {
            font-size: 2rem;
            letter-spacing: 0.5rem;
            text-align: center;
            border: 3px solid #8B5CF6;
            border-radius: 1rem;
            padding: 1rem;
            background: white;
            color: #4C1D95;
            font-weight: bold;
        }
        .pin-input:focus {
            outline: none;
            border-color: #EC4899;
            box-shadow: 0 0 20px rgba(236, 72, 153, 0.5);
        }
        .pin-error {
            animation: shake 0.5s ease-in-out;
        }
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-10px); }
            75% { transform: translateX(10px); }
        }
        .hidden {
            display: none !important;
        }
    </style>
</head>
<body class="min-h-screen p-4">
    <!-- PIN Entry Screen -->
    <div id="pinScreen" class="pin-screen">
        <div class="bg-white rounded-3xl p-8 shadow-2xl text-center max-w-md w-full mx-4">
            <div class="mb-6">
                <i class="fas fa-lock text-6xl text-purple-600 mb-4 sparkle"></i>
                <h2 class="title-font text-4xl text-purple-600 mb-2">üîê Enter PIN</h2>
                <p class="text-gray-600 text-lg">Enter your 4-digit PIN to access Ellie's schedule!</p>
            </div>
            
            <div class="mb-6">
                <input 
                    type="password" 
                    id="pinInput" 
                    class="pin-input w-full" 
                    maxlength="4" 
                    placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢"
                    autofocus
                >
            </div>
            
            <div id="pinError" class="text-red-500 font-bold mb-4 hidden">
                üö´ Incorrect PIN! Try again.
            </div>
            
            <button 
                id="submitPin" 
                class="bg-gradient-to-r from-purple-500 to-pink-500 text-white font-bold py-3 px-8 rounded-2xl text-xl hover:from-purple-600 hover:to-pink-600 transition-all duration-300 transform hover:scale-105"
            >
                üåü Enter Schedule! üåü
            </button>
            
            <div class="mt-6 text-gray-500 text-sm">
                üí° Hint: It's the special number!<br>
                üë®‚Äçüë©‚Äçüëß‚Äçüë¶ Parents: Use 0000 for dashboard
            </div>
        </div>
    </div>

    <!-- Parent Dashboard (hidden until parent PIN is correct) -->
    <div id="parentDashboard" class="hidden">
        <div class="max-w-6xl mx-auto p-4">
            <div class="bg-white rounded-3xl p-8 shadow-2xl mb-6">
                <div class="flex justify-between items-center mb-6">
                    <h1 class="title-font text-4xl text-blue-600">üë®‚Äçüë©‚Äçüëß‚Äçüë¶ Parent Dashboard</h1>
                    <button onclick="logout()" class="bg-gray-500 text-white px-4 py-2 rounded-lg hover:bg-gray-600">
                        üö™ Logout
                    </button>
                </div>
                
                <!-- Progress Summary -->
                <div id="progressSummary" class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-6">
                    <!-- Will be populated by JavaScript -->
                </div>
                
                <!-- Recent Progress Chart -->
                <div class="bg-gray-50 rounded-2xl p-6 mb-6">
                    <h3 class="text-2xl font-bold text-gray-800 mb-4">üìà Recent Progress</h3>
                    <div id="recentProgress" class="space-y-2">
                        <!-- Will be populated by JavaScript -->
                    </div>
                </div>
                
                <!-- Export & Tools -->
                <div class="flex flex-wrap gap-4">
                    <button onclick="storage.exportData()" class="bg-green-500 text-white px-6 py-3 rounded-xl hover:bg-green-600 font-bold">
                        üíæ Download Progress Data
                    </button>
                    <button onclick="showDetailedHistory()" class="bg-blue-500 text-white px-6 py-3 rounded-xl hover:bg-blue-600 font-bold">
                        üìä Detailed History
                    </button>
                    <button onclick="refreshDashboard()" class="bg-purple-500 text-white px-6 py-3 rounded-xl hover:bg-purple-600 font-bold">
                        üîÑ Refresh Data
                    </button>
                </div>
            </div>
            
            <!-- Detailed History (initially hidden) -->
            <div id="detailedHistory" class="bg-white rounded-3xl p-8 shadow-2xl hidden">
                <h3 class="text-2xl font-bold text-gray-800 mb-4">üìã Detailed History</h3>
                <div id="historyContent">
                    <!-- Will be populated by JavaScript -->
                </div>
            </div>
        </div>
    </div>

    <!-- Main Schedule (hidden until PIN is correct) -->
    <div id="mainSchedule" class="hidden">
        <div class="max-w-6xl mx-auto">
            <!-- Header -->
            <div class="text-center mb-8 bg-white rounded-3xl p-8 shadow-2xl">
                <h1 class="title-font text-6xl text-purple-600 mb-4 sparkle">
                    üåà Ellie's Super Fun Daily Adventure! üåü
                </h1>
                
                <!-- Dynamic Day Information -->
                <div class="day-info">
                    <h2 id="currentDay" class="text-2xl font-bold mb-2"></h2>
                    <p id="dayProgress" class="text-lg"></p>
                </div>
                
                <p class="text-2xl text-gray-700 mb-6">
                    Complete your daily quests and become a Super Star! ‚≠ê
                </p>
                
                <!-- Progress Overview -->
                <div class="flex justify-center mb-6">
                    <div class="bg-gradient-to-r from-pink-300 to-purple-300 rounded-full p-4 relative" style="width: 200px; height: 200px;">
                        <canvas id="progressChart" width="160" height="160"></canvas>
                        <div class="absolute inset-0 flex items-center justify-center">
                            <div class="text-center">
                                <div id="progressText" class="text-3xl font-bold text-purple-800">0%</div>
                                <div class="text-sm text-purple-600">Complete!</div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Achievement Stars -->
                <div id="starContainer" class="flex justify-center space-x-2 mb-4">
                    <i class="fas fa-star text-gray-300 text-4xl" data-star="1"></i>
                    <i class="fas fa-star text-gray-300 text-4xl" data-star="2"></i>
                    <i class="fas fa-star text-gray-300 text-4xl" data-star="3"></i>
                    <i class="fas fa-star text-gray-300 text-4xl" data-star="4"></i>
                    <i class="fas fa-star text-gray-300 text-4xl" data-star="5"></i>
                </div>
            </div>

            <!-- Daily Activities Grid -->
            <div id="activitiesGrid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                <!-- Activities will be dynamically generated here -->
            </div>

            <!-- Reward System -->
            <div class="mt-8 bg-gradient-to-r from-purple-400 to-pink-400 rounded-3xl p-8 shadow-2xl text-white text-center">
                <h2 class="title-font text-4xl mb-6">üèÜ Ellie's Amazing Rewards! üèÜ</h2>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                    <div class="bg-white bg-opacity-20 rounded-2xl p-4">
                        <div class="text-4xl mb-2">üåü</div>
                        <h3 class="text-xl font-bold mb-2">Daily Star</h3>
                        <p class="text-sm">Complete 70% of activities</p>
                    </div>
                    <div class="bg-white bg-opacity-20 rounded-2xl p-4">
                        <div class="text-4xl mb-2">üé®</div>
                        <h3 class="text-xl font-bold mb-2">Art Time</h3>
                        <p class="text-sm">Extra creative activities</p>
                    </div>
                    <div class="bg-white bg-opacity-20 rounded-2xl p-4">
                        <div class="text-4xl mb-2">üéâ</div>
                        <h3 class="text-xl font-bold mb-2">Special Treat</h3>
                        <p class="text-sm">Weekend surprise activity</p>
                    </div>
                </div>
            </div>

            <!-- Motivational Messages -->
            <div id="motivationBox" class="mt-6 bg-yellow-100 border-l-4 border-yellow-500 p-4 rounded-r-2xl hidden">
                <div class="flex items-center">
                    <div class="flex-shrink-0">
                        <i class="fas fa-star text-yellow-500 text-2xl"></i>
                    </div>
                    <div class="ml-3">
                        <p id="motivationText" class="text-lg font-medium text-yellow-800"></p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // PIN Protection
        const CORRECT_PIN = '7449';
        const PARENT_PIN = '0000';
        
        // Data Storage System
        class EllieStorage {
            constructor() {
                this.storageKey = 'ellie_schedule_data';
                this.backupKey = 'ellie_schedule_backup';
            }
            
            // Get today's date string
            getTodayString() {
                return new Date().toISOString().split('T')[0];
            }
            
            // Load all data
            loadData() {
                try {
                    const data = localStorage.getItem(this.storageKey);
                    return data ? JSON.parse(data) : {};
                } catch (e) {
                    console.log('Loading backup data...');
                    try {
                        const backup = localStorage.getItem(this.backupKey);
                        return backup ? JSON.parse(backup) : {};
                    } catch (e2) {
                        return {};
                    }
                }
            }
            
            // Save data with backup
            saveData(data) {
                try {
                    // Save main data
                    localStorage.setItem(this.storageKey, JSON.stringify(data));
                    // Save backup copy
                    localStorage.setItem(this.backupKey, JSON.stringify(data));
                    console.log('Progress saved successfully!');
                } catch (e) {
                    console.error('Failed to save progress:', e);
                }
            }
            
            // Get today's progress
            getTodayProgress() {
                const data = this.loadData();
                const today = this.getTodayString();
                return data[today] || { 
                    completedActivities: [],
                    totalActivities: 0,
                    completionRate: 0,
                    lastUpdated: new Date().toISOString(),
                    dayNumber: this.calculateDayNumber()
                };
            }
            
            // Save today's progress
            saveTodayProgress(completedActivities, totalActivities) {
                const data = this.loadData();
                const today = this.getTodayString();
                const completionRate = Math.round((completedActivities.length / totalActivities) * 100);
                
                data[today] = {
                    completedActivities: completedActivities,
                    totalActivities: totalActivities,
                    completionRate: completionRate,
                    lastUpdated: new Date().toISOString(),
                    dayNumber: this.calculateDayNumber(),
                    activities: this.getCurrentActivities()
                };
                
                this.saveData(data);
                return data[today];
            }
            
            // Calculate which day of summer this is
            calculateDayNumber() {
                const startDate = new Date('2024-06-20');
                const today = new Date();
                const diffTime = today - startDate;
                const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
                return Math.max(1, diffDays);
            }
            
            // Get current activities for reference
            getCurrentActivities() {
                const activities = [];
                document.querySelectorAll('.activity-checkbox').forEach(checkbox => {
                    const activityText = checkbox.nextElementSibling.textContent;
                    activities.push({
                        id: checkbox.dataset.activity,
                        text: activityText,
                        completed: checkbox.checked
                    });
                });
                return activities;
            }
            
            // Get progress summary
            getProgressSummary() {
                const data = this.loadData();
                const days = Object.keys(data).sort();
                
                if (days.length === 0) return null;
                
                const totalDays = days.length;
                const completionRates = days.map(day => data[day].completionRate || 0);
                const averageCompletion = Math.round(completionRates.reduce((a, b) => a + b, 0) / totalDays);
                const bestDay = days.find(day => data[day].completionRate === Math.max(...completionRates));
                const currentStreak = this.calculateCurrentStreak(data, days);
                
                return {
                    totalDays,
                    averageCompletion,
                    bestDay,
                    bestScore: Math.max(...completionRates),
                    currentStreak,
                    recentDays: days.slice(-7).map(day => ({
                        date: day,
                        completion: data[day].completionRate,
                        activities: data[day].completedActivities.length
                    }))
                };
            }
            
            // Calculate current streak
            calculateCurrentStreak(data, days) {
                let streak = 0;
                for (let i = days.length - 1; i >= 0; i--) {
                    if (data[days[i]].completionRate >= 70) {
                        streak++;
                    } else {
                        break;
                    }
                }
                return streak;
            }
            
            // Export data as JSON
            exportData() {
                const data = this.loadData();
                const summary = this.getProgressSummary();
                const exportData = {
                    exportDate: new Date().toISOString(),
                    summary: summary,
                    dailyProgress: data
                };
                
                const blob = new Blob([JSON.stringify(exportData, null, 2)], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `ellie_progress_${new Date().toISOString().split('T')[0]}.json`;
                a.click();
                URL.revokeObjectURL(url);
            }
        }
        
        // Initialize storage system
        const storage = new EllieStorage();
        
        // Initialize when DOM is ready
        document.addEventListener('DOMContentLoaded', function() {
            // Check if already authenticated in this session
            if (sessionStorage.getItem('pinAuthenticated') === 'true') {
                showMainSchedule();
            } else if (sessionStorage.getItem('parentAuthenticated') === 'true') {
                showParentDashboard();
            }
            
            // PIN input handling (safe to access DOM elements now)
            const pinInput = document.getElementById('pinInput');
            const submitPin = document.getElementById('submitPin');
            const pinError = document.getElementById('pinError');
            
            if (!pinInput || !submitPin || !pinError) {
                console.error('PIN elements not found! Check HTML structure.');
                return;
            }
            
            setupPinHandlers(pinInput, submitPin, pinError);
        });
        
        function setupPinHandlers(pinInput, submitPin, pinError) {
            // Auto-submit when 4 digits are entered
            pinInput.addEventListener('input', function() {
                if (this.value.length === 4) {
                    setTimeout(() => checkPin(pinInput, pinError), 300); // Small delay for better UX
                }
            });
            
            // Submit button click
            submitPin.addEventListener('click', () => checkPin(pinInput, pinError));
            
            // Enter key press
            pinInput.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    checkPin(pinInput, pinError);
                }
            });
        }
        
        function checkPin(pinInput, pinError) {
            const enteredPin = pinInput.value;
            
            if (enteredPin === CORRECT_PIN) {
                // Correct PIN - show success and redirect
                sessionStorage.setItem('pinAuthenticated', 'true');
                pinInput.style.borderColor = '#10B981';
                pinInput.style.backgroundColor = '#D1FAE5';
                
                // Celebration effect
                const pinScreen = document.getElementById('pinScreen');
                pinScreen.innerHTML = `
                    <div class="bg-white rounded-3xl p-8 shadow-2xl text-center max-w-md w-full mx-4">
                        <div class="text-6xl mb-4 sparkle">üéâ</div>
                        <h2 class="title-font text-4xl text-green-600 mb-4">Welcome Ellie!</h2>
                        <p class="text-gray-600 text-lg mb-6">Loading your daily adventure...</p>
                        <div class="flex justify-center">
                            <div class="animate-spin rounded-full h-8 w-8 border-b-2 border-purple-600"></div>
                        </div>
                    </div>
                `;
                
                setTimeout(showMainSchedule, 2000);
            } else if (enteredPin === PARENT_PIN) {
                // Parent PIN - show parent dashboard
                sessionStorage.setItem('parentAuthenticated', 'true');
                pinInput.style.borderColor = '#10B981';
                pinInput.style.backgroundColor = '#D1FAE5';
                
                const pinScreen = document.getElementById('pinScreen');
                pinScreen.innerHTML = `
                    <div class="bg-white rounded-3xl p-8 shadow-2xl text-center max-w-md w-full mx-4">
                        <div class="text-6xl mb-4">üë®‚Äçüë©‚Äçüëß‚Äçüë¶</div>
                        <h2 class="title-font text-4xl text-blue-600 mb-4">Parent Dashboard</h2>
                        <p class="text-gray-600 text-lg mb-6">Loading progress reports...</p>
                        <div class="flex justify-center">
                            <div class="animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"></div>
                        </div>
                    </div>
                `;
                
                setTimeout(showParentDashboard, 2000);
            } else {
                // Wrong PIN - show error
                pinError.classList.remove('hidden');
                pinInput.classList.add('pin-error');
                pinInput.style.borderColor = '#EF4444';
                pinInput.value = '';
                
                setTimeout(() => {
                    pinInput.classList.remove('pin-error');
                    pinInput.style.borderColor = '#8B5CF6';
                    pinError.classList.add('hidden');
                }, 2000);
                
                pinInput.focus();
            }
        }
        
        function showMainSchedule() {
            document.getElementById('pinScreen').classList.add('hidden');
            document.getElementById('parentDashboard').classList.add('hidden');
            document.getElementById('mainSchedule').classList.remove('hidden');
            initializeDailySchedule();
        }
        
        function showParentDashboard() {
            document.getElementById('pinScreen').classList.add('hidden');
            document.getElementById('mainSchedule').classList.add('hidden');
            document.getElementById('parentDashboard').classList.remove('hidden');
            loadParentDashboard();
        }
        
        function logout() {
            sessionStorage.clear();
            document.getElementById('parentDashboard').classList.add('hidden');
            document.getElementById('mainSchedule').classList.add('hidden');
            document.getElementById('pinScreen').classList.remove('hidden');
            // Reset PIN screen
            location.reload();
        }
        
        function loadParentDashboard() {
            const summary = storage.getProgressSummary();
            const summaryDiv = document.getElementById('progressSummary');
            const recentDiv = document.getElementById('recentProgress');
            
            if (!summaryDiv || !recentDiv) {
                console.error('Parent dashboard elements not found!');
                return;
            }
            
            if (!summary) {
                summaryDiv.innerHTML = '<div class="col-span-4 text-center text-gray-500 text-xl">No progress data yet. Ellie hasn\'t started her schedule!</div>';
                recentDiv.innerHTML = '<div class="text-gray-500">No recent activity</div>';
                return;
            }
            
            // Progress Summary Cards
            summaryDiv.innerHTML = `
                <div class="bg-gradient-to-r from-blue-400 to-blue-600 text-white p-6 rounded-2xl text-center">
                    <h4 class="text-lg font-bold">Total Days</h4>
                    <p class="text-3xl font-bold">${summary.totalDays}</p>
                </div>
                <div class="bg-gradient-to-r from-green-400 to-green-600 text-white p-6 rounded-2xl text-center">
                    <h4 class="text-lg font-bold">Average Score</h4>
                    <p class="text-3xl font-bold">${summary.averageCompletion}%</p>
                </div>
                <div class="bg-gradient-to-r from-purple-400 to-purple-600 text-white p-6 rounded-2xl text-center">
                    <h4 class="text-lg font-bold">Best Day</h4>
                    <p class="text-3xl font-bold">${summary.bestScore}%</p>
                    <p class="text-sm opacity-80">${summary.bestDay}</p>
                </div>
                <div class="bg-gradient-to-r from-orange-400 to-orange-600 text-white p-6 rounded-2xl text-center">
                    <h4 class="text-lg font-bold">Current Streak</h4>
                    <p class="text-3xl font-bold">${summary.currentStreak}</p>
                    <p class="text-sm opacity-80">days ‚â•70%</p>
                </div>
            `;
            
            // Recent Progress
            recentDiv.innerHTML = summary.recentDays.map(day => `
                <div class="flex items-center justify-between bg-white p-4 rounded-xl shadow-sm">
                    <div>
                        <span class="font-bold text-gray-800">${day.date}</span>
                        <span class="text-gray-600 ml-2">(${day.activities} activities completed)</span>
                    </div>
                    <div class="flex items-center">
                        <div class="w-32 bg-gray-200 rounded-full h-3 mr-3">
                            <div class="bg-gradient-to-r from-green-400 to-green-600 h-3 rounded-full" style="width: ${day.completion}%"></div>
                        </div>
                        <span class="font-bold text-lg ${day.completion >= 70 ? 'text-green-600' : 'text-orange-600'}">${day.completion}%</span>
                    </div>
                </div>
            `).join('');
        }
        
        function showDetailedHistory() {
            const historyDiv = document.getElementById('detailedHistory');
            const contentDiv = document.getElementById('historyContent');
            const data = storage.loadData();
            
            if (Object.keys(data).length === 0) {
                contentDiv.innerHTML = '<div class="text-gray-500 text-center">No detailed history available yet.</div>';
            } else {
                const sortedDays = Object.keys(data).sort().reverse();
                contentDiv.innerHTML = sortedDays.map(date => {
                    const dayData = data[date];
                    return `
                        <div class="mb-6 p-4 border rounded-xl">
                            <div class="flex justify-between items-center mb-3">
                                <h4 class="text-xl font-bold">${date} (Day ${dayData.dayNumber})</h4>
                                <span class="text-2xl font-bold ${dayData.completionRate >= 70 ? 'text-green-600' : 'text-orange-600'}">
                                    ${dayData.completionRate}%
                                </span>
                            </div>
                            <div class="text-sm text-gray-600 mb-2">
                                Completed: ${dayData.completedActivities.length}/${dayData.totalActivities} activities
                            </div>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-2 text-sm">
                                ${dayData.activities ? dayData.activities.map(activity => `
                                    <div class="flex items-center">
                                        <span class="mr-2">${activity.completed ? '‚úÖ' : '‚¨ú'}</span>
                                        <span class="${activity.completed ? 'text-green-600' : 'text-gray-400'}">${activity.text}</span>
                                    </div>
                                `).join('') : '<div class="text-gray-400">Activity details not available</div>'}
                            </div>
                        </div>
                    `;
                }).join('');
            }
            
            historyDiv.classList.toggle('hidden');
        }
        
        function refreshDashboard() {
            loadParentDashboard();
        }

        // Progress tracking variables
        let completedActivities = 0;
        let totalActivities = 0;
        
        // Date management
        const startDate = new Date('2024-06-20');
        const endDate = new Date('2024-08-31');
        const today = new Date();
        
        // Activity pools for variety
        const activityPools = {
            morningRoutine: {
                title: "üåÖ Rise & Shine!",
                time: "7:00 - 8:00 AM",
                gradient: "from-yellow-200 to-orange-200",
                textColor: "orange-800",
                image: "https://thumbs.dreamstime.com/b/kids-routine-actions-tooth-brushing-washing-face-taking-shower-hair-care-girl-ginger-jpeg-image-dpi-rgb-102778269.jpg",
                activities: [
                    "üõèÔ∏è Wake up and stretch",
                    "ü¶∑ Brush teeth like a superhero", 
                    "üíß Wash face and get ready"
                ]
            },
            breakfast: {
                title: "üç≥ Yummy Breakfast!",
                time: "8:00 - 8:30 AM",
                gradient: "from-green-200 to-blue-200",
                textColor: "blue-800",
                image: "https://thumbs.dreamstime.com/b/cartoon-children-preparing-breakfast-together-family-fun-healthy-eating-illustration-cute-smiles-perfect-380081866.jpg",
                activities: [
                    "ü•û Eat a healthy breakfast",
                    "üíß Drink water or milk",
                    "üçΩÔ∏è Help clear dishes"
                ]
            },
            learning: {
                title: "‚úèÔ∏è Learning Adventure!",
                time: "9:00 - 11:00 AM",
                gradient: "from-purple-200 to-pink-200",
                textColor: "purple-800",
                image: "https://www.theottoolbox.com/wp-content/uploads/2016/04/tangle-handwriting-art.jpg",
                activities: [
                    ["‚úçÔ∏è Handwriting practice", "üìù Journal writing", "üî§ Letter formation"],
                    ["üìö Reading adventure", "üìñ Story exploration", "üìï Comic book time"],
                    ["üé® Art and creativity", "üñçÔ∏è Coloring masterpiece", "‚úÇÔ∏è Craft project"]
                ]
            },
            math: {
                title: "üî¢ Math Magic!",
                time: "11:15 AM - 12:00 PM",
                gradient: "from-red-200 to-yellow-200",
                textColor: "red-800",
                image: "https://www.21kschool.com/ir/wp-content/uploads/sites/34/2025/01/Free-Maths-Games-for-Kids.png",
                activities: [
                    ["üé≤ Fun math games", "üßÆ Counting games", "üî¢ Number puzzles"],
                    ["üî¢ Addition practice", "‚ûñ Subtraction fun", "üìè Measuring objects"],
                    ["üß© Logic puzzles", "üéØ Math challenges", "üåü Number patterns"]
                ]
            },
            lunch: {
                title: "üçΩÔ∏è Lunch Time!",
                time: "12:00 - 1:00 PM",
                gradient: "from-orange-200 to-red-200",
                textColor: "orange-800",
                image: "https://c8.alamy.com/comp/2JM990C/funny-breakfast-food-with-faces-cartoon-illustration-set-cute-porridge-fruits-berries-boiled-egg-biscuits-characters-cups-of-coffee-tea-and-tea-2JM990C.jpg",
                activities: [
                    "ü•ó Eat nutritious lunch",
                    "üç¥ Practice table manners",
                    "‚ú® Help with cleanup"
                ]
            },
            reading: {
                title: "üìñ Story Time!",
                time: "2:00 - 3:00 PM",
                gradient: "from-teal-200 to-cyan-200",
                textColor: "teal-800",
                image: "https://www.shutterstock.com/image-vector/children-reading-book-nature-600nw-2285394651.jpg",
                activities: [
                    ["üìö Adventure stories", "üßö Fairy tales", "ü¶Ñ Fantasy books"],
                    ["üé≠ Act out stories", "üó£Ô∏è Tell a story", "üé™ Story performance"],
                    ["üìù Learn new words", "üî§ Vocabulary game", "üìñ Reading challenge"]
                ]
            },
            piano: {
                title: "üéπ Piano Practice!",
                time: "3:00 - 4:00 PM",
                gradient: "from-indigo-200 to-purple-200",
                textColor: "indigo-800",
                image: "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcRj4MlLUGK7B5nZCFW8iqVJxHxHGsF3y0DcWg&s",
                activities: [
                    ["üéµ Practice scales", "üé∂ Finger exercises", "üéº Music theory"],
                    ["üéπ Learn new song", "üéµ Practice favorite piece", "üé∂ Improvisation time"],
                    ["üéº Read sheet music", "üëÇ Ear training", "üéµ Rhythm practice"]
                ]
            },
            afternoon: {
                title: "üåû Afternoon Fun!",
                time: "4:00 - 5:30 PM",
                gradient: "from-pink-200 to-rose-200",
                textColor: "pink-800",
                image: "https://img.freepik.com/free-vector/children-playing-park-illustration_1308-32397.jpg",
                activities: [
                    ["üèÉ Outdoor play", "üö¥ Bike riding", "‚öΩ Ball games"],
                    ["üß© Puzzle time", "üé≤ Board games", "üÉè Card games"],
                    ["üå± Garden activities", "üß™ Science experiments", "üîç Nature exploration"]
                ]
            },
            evening: {
                title: "üåô Evening Wind Down!",
                time: "6:00 - 7:00 PM",
                gradient: "from-violet-200 to-purple-200",
                textColor: "violet-800",
                image: "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcTUhKfSMkUlzTjQqf-1sDzZTvUzKzJKQXLbXQ&s",
                activities: [
                    ["üé® Free art time", "üßò Quiet time", "üìö Read together"],
                    ["üé≠ Imaginative play", "üè† Help with dinner", "üéµ Listen to music"],
                    ["‚ú® Organize room", "üìî Reflect on day", "üåü Plan tomorrow"]
                ]
            }
        };
        
        // Motivational messages
        const motivationalMessages = [
            "üåü Great start, Ellie! You're doing amazing!",
            "üí™ Keep going! You're building great habits!",
            "üéâ Fantastic job! You're almost there!",
            "‚≠ê Outstanding work! You're a superstar!",
            "üèÜ Incredible! You've completed your daily adventure!"
        ];

        // Initialize the daily schedule
        function initializeDailySchedule() {
            updateDayInfo();
            generateDailyActivities();
            loadTodayProgress(); // Load saved progress
            initializeProgressChart();
            setupEventListeners();
            showWelcomeMessage();
        }
        
        // Load today's progress from storage
        function loadTodayProgress() {
            const todayData = storage.getTodayProgress();
            const completedIds = todayData.completedActivities || [];
            
            // Restore checkboxes
            completedActivities = 0;
            document.querySelectorAll('.activity-checkbox').forEach(checkbox => {
                if (completedIds.includes(checkbox.dataset.activity)) {
                    checkbox.checked = true;
                    checkbox.closest('.activity-card').classList.add('completed');
                    completedActivities++;
                }
            });
            
            // Update displays
            updateProgress();
            updateStars();
            
            // Show restore message if there was previous progress
            if (completedIds.length > 0) {
                setTimeout(() => {
                    const motivationBox = document.getElementById('motivationBox');
                    const motivationText = document.getElementById('motivationText');
                    motivationText.textContent = `üîÑ Welcome back! Restored your ${completedIds.length} completed activities!`;
                    motivationBox.classList.remove('hidden');
                    
                    setTimeout(() => {
                        motivationBox.classList.add('hidden');
                    }, 4000);
                }, 1500);
            }
        }
        
        // Save progress to storage
        function saveProgress() {
            const completedIds = [];
            document.querySelectorAll('.activity-checkbox:checked').forEach(checkbox => {
                completedIds.push(checkbox.dataset.activity);
            });
            
            storage.saveTodayProgress(completedIds, totalActivities);
        }

        // Update day information
        function updateDayInfo() {
            const dayNames = ['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'];
            const monthNames = ['January', 'February', 'March', 'April', 'May', 'June', 
                              'July', 'August', 'September', 'October', 'November', 'December'];
            
            const dayName = dayNames[today.getDay()];
            const monthName = monthNames[today.getMonth()];
            const date = today.getDate();
            
            document.getElementById('currentDay').textContent = 
                `${dayName}, ${monthName} ${date}`;
            
            // Calculate progress through summer schedule
            const totalDays = Math.ceil((endDate - startDate) / (1000 * 60 * 60 * 24));
            const currentDay = Math.ceil((today - startDate) / (1000 * 60 * 60 * 24));
            
            if (currentDay > 0 && currentDay <= totalDays) {
                document.getElementById('dayProgress').textContent = 
                    `Day ${currentDay} of ${totalDays} in your Summer Adventure!`;
            } else if (currentDay > totalDays) {
                document.getElementById('dayProgress').textContent = 
                    `üéâ Summer Adventure Complete! Keep up the great habits!`;
            } else {
                document.getElementById('dayProgress').textContent = 
                    `üåü Get ready for your Summer Adventure starting June 20th!`;
            }
        }

        // Generate activities for the current day
        function generateDailyActivities() {
            const grid = document.getElementById('activitiesGrid');
            grid.innerHTML = '';
            
            // Use day of year as seed for consistent but varied activities
            const dayOfYear = Math.floor((today - new Date(today.getFullYear(), 0, 0)) / (1000 * 60 * 60 * 24));
            
            // Generate each activity block
            const schedule = ['morningRoutine', 'breakfast', 'learning', 'math', 'lunch', 'reading', 'piano', 'afternoon', 'evening'];
            
            schedule.forEach((activityType, index) => {
                const activity = activityPools[activityType];
                const card = createActivityCard(activity, activityType, dayOfYear + index);
                grid.appendChild(card);
            });
            
            // Update total activities count
            totalActivities = document.querySelectorAll('.activity-checkbox').length;
        }

        // Create an activity card
        function createActivityCard(activity, type, seed) {
            const card = document.createElement('div');
            card.className = `activity-card bg-gradient-to-br ${activity.gradient} rounded-3xl p-6 shadow-xl`;
            
            // Select activities based on seed for variety
            let selectedActivities = [];
            if (Array.isArray(activity.activities[0])) {
                // Has multiple options per slot
                activity.activities.forEach((options, i) => {
                    const option = options[(seed + i) % options.length];
                    selectedActivities.push(option);
                });
            } else {
                // Fixed activities
                selectedActivities = activity.activities;
            }
            
            card.innerHTML = `
                <div class="flex items-center mb-4">
                    <img src="${activity.image}" 
                         alt="${activity.title}" class="w-16 h-16 rounded-full object-cover mr-4">
                    <div>
                        <h3 class="text-2xl font-bold text-${activity.textColor}">${activity.title}</h3>
                        <p class="text-${activity.textColor} text-sm opacity-75">${activity.time}</p>
                    </div>
                </div>
                <ul class="space-y-3">
                    ${selectedActivities.map((act, i) => `
                        <li class="flex items-center">
                            <input type="checkbox" class="activity-checkbox mr-3 w-5 h-5" data-activity="${type}-${i}">
                            <span class="text-lg">${act}</span>
                        </li>
                    `).join('')}
                </ul>
            `;
            
            return card;
        }

        // Initialize progress chart
        function initializeProgressChart() {
            const ctx = document.getElementById('progressChart').getContext('2d');
            window.progressChart = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    datasets: [{
                        data: [0, 100],
                        backgroundColor: ['#8B5CF6', '#E5E7EB'],
                        borderWidth: 0
                    }]
                },
                options: {
                    responsive: false,
                    maintainAspectRatio: false,
                    cutout: '70%',
                    plugins: {
                        legend: {
                            display: false
                        }
                    }
                }
            });
        }

        // Setup event listeners
        function setupEventListeners() {
            // Use event delegation for dynamically created checkboxes
            document.addEventListener('change', function(e) {
                if (e.target.classList.contains('activity-checkbox')) {
                    const card = e.target.closest('.activity-card');
                    
                    if (e.target.checked) {
                        completedActivities++;
                        card.classList.add('completed');
                        card.classList.add('celebration');
                        setTimeout(() => card.classList.remove('celebration'), 1000);
                    } else {
                        completedActivities--;
                        card.classList.remove('completed');
                    }
                    
                    updateProgress();
                    updateStars();
                    showMotivation();
                    
                    // Save progress to localStorage
                    saveProgress();
                }
            });
        }

        // Update progress chart and text
        function updateProgress() {
            const percentage = Math.round((completedActivities / totalActivities) * 100);
            
            // Update chart
            if (window.progressChart) {
                window.progressChart.data.datasets[0].data = [percentage, 100 - percentage];
                window.progressChart.update();
            }
            
            // Update text
            document.getElementById('progressText').textContent = percentage + '%';
        }

        // Update achievement stars
        function updateStars() {
            const percentage = (completedActivities / totalActivities) * 100;
            const stars = document.querySelectorAll('[data-star]');
            
            stars.forEach((star, index) => {
                if (percentage >= (index + 1) * 20) {
                    star.className = 'fas fa-star text-yellow-400 text-4xl sparkle';
                } else {
                    star.className = 'fas fa-star text-gray-300 text-4xl';
                }
            });
        }

        // Show motivational messages
        function showMotivation() {
            const percentage = (completedActivities / totalActivities) * 100;
            const motivationBox = document.getElementById('motivationBox');
            const motivationText = document.getElementById('motivationText');
            
            let messageIndex = Math.floor(percentage / 20);
            if (messageIndex >= motivationalMessages.length) {
                messageIndex = motivationalMessages.length - 1;
            }
            
            if (percentage > 0) {
                motivationText.textContent = motivationalMessages[messageIndex];
                motivationBox.classList.remove('hidden');
                
                setTimeout(() => {
                    motivationBox.classList.add('hidden');
                }, 3000);
            }
        }

        // Show welcome message
        function showWelcomeMessage() {
            setTimeout(() => {
                const motivationBox = document.getElementById('motivationBox');
                const motivationText = document.getElementById('motivationText');
                motivationText.textContent = "üåà Welcome to your daily adventure, Ellie! Let's make today amazing!";
                motivationBox.classList.remove('hidden');
                
                setTimeout(() => {
                    motivationBox.classList.add('hidden');
                }, 4000);
            }, 1000);
        }

        // Add sparkle effects
        function createSparkle() {
            const sparkle = document.createElement('div');
            sparkle.innerHTML = '‚ú®';
            sparkle.style.position = 'fixed';
            sparkle.style.left = Math.random() * window.innerWidth + 'px';
            sparkle.style.top = Math.random() * window.innerHeight + 'px';
            sparkle.style.fontSize = '20px';
            sparkle.style.pointerEvents = 'none';
            sparkle.style.zIndex = '9999';
            sparkle.style.animation = 'sparkle 2s ease-out forwards';
            
            document.body.appendChild(sparkle);
            
            setTimeout(() => {
                sparkle.remove();
            }, 2000);
        }

        // Create sparkles periodically (only when schedule is visible)
        setInterval(() => {
            if (!document.getElementById('mainSchedule') || document.getElementById('mainSchedule').classList.contains('hidden')) {
                return;
            }
            createSparkle();
        }, 3000);
        
        // System validation on load
        function validateSystem() {
            console.log('üîç Validating Ellie\'s Schedule System...');
            
            // Test 1: Storage system
            try {
                const testStorage = new EllieStorage();
                testStorage.saveData({test: 'validation'});
                const loadedData = testStorage.loadData();
                console.log('‚úÖ Storage system working');
            } catch (e) {
                console.error('‚ùå Storage system failed:', e);
            }
            
            // Test 2: Date functions
            try {
                const storage = new EllieStorage();
                const today = storage.getTodayString();
                const dayNum = storage.calculateDayNumber();
                console.log(`‚úÖ Date system working: ${today}, Day ${dayNum}`);
            } catch (e) {
                console.error('‚ùå Date system failed:', e);
            }
            
            // Test 3: Activity generation
            try {
                if (typeof activityPools !== 'undefined' && Object.keys(activityPools).length > 0) {
                    console.log('‚úÖ Activity pools loaded:', Object.keys(activityPools).length, 'types');
                } else {
                    console.error('‚ùå Activity pools missing or empty');
                }
            } catch (e) {
                console.error('‚ùå Activity system failed:', e);
            }
            
            console.log('üéØ System validation complete');
        }
        
        // Run validation after a short delay
        setTimeout(validateSystem, 1000);
    </script>
</body>
</html>
